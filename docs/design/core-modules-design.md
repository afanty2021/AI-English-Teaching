# AI赋能英语教学系统 - 核心模块设计

> **文档版本**: v1.0
> **创建日期**: 2026-02-01
> **架构类型**: 混合架构（平衡开发速度与成本控制）

---

## 目录

1. [系统架构概览](#一系统架构概览)
2. [知识图谱诊断模块](#二知识图谱诊断模块)
3. [智能分级推送模块](#三智能分级推送模块)
4. [AI口语陪练模块](#四ai口语陪练模块)
5. [AI辅助备课模块](#五ai辅助备课模块)

---

## 一、系统架构概览

```
┌─────────────────────────────────────────────────────────────────────┐
│                        前端层 (Vue3)                                │
├─────────────────────────────────────────────────────────────────────┤
│  教师端                              学生端                        │
│  - 班级管理                          - 我的课程                     │
│  - 学生诊断报告                      - 个性化练习                   │
│  - AI备课助手                        - AI口语对话                   │
│  - 教学内容库                        - 进度追踪                     │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ REST API / WebSocket
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                        应用层 (FastAPI)                              │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌───────────┐ │
│  │  用户服务   │  │  内容服务   │  │  学习服务   │  │  AI服务   │ │
│  │             │  │             │  │             │  │           │ │
│  │ - 认证授权  │  │ - 素材管理  │  │ - 能力诊断  │  │ - 智能路由│ │
│  │ - 角色管理  │  │ - 难度分级  │  │ - 知识图谱  │  │ - 提示优化│ │
│  │ - 组织架构  │  │ - 标签体系  │  │ - 进度追踪  │  │ - 成本控制│ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └───────────┘ │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                     智能缓存层                               │   │
│  │  - Redis: 会话/热点数据/队列                                │   │
│  │  - 向量搜索: 内容相似度匹配（本地完成，减少AI调用）          │   │
│  └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                        数据层 (Data Layer)                           │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐  ┌───────────────────┐  │
│  │   PostgreSQL    │  │     Redis       │  │   向量数据库      │  │
│  │                 │  │                 │  │                   │  │
│  │ - 用户/组织     │  │ - 缓存          │  │ - 内容向量        │  │
│  │ - 学习记录      │  │ - 会话          │  │ - 题目向量        │  │
│  │ - 知识图谱      │  │ - 队列          │  │ - 学生画像向量    │  │
│  │ - 内容库        │  │ - 锁           │  │                   │  │
│  └─────────────────┘  └─────────────────┘  └───────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                        AI服务层 (AI Services)                        │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │
│  │ OpenAI API  │  │ 语音服务    │  │ 本地模型    │                 │
│  │             │  │             │  │ (可选)      │                 │
│  │ - GPT-4     │  │ - TTS/STT   │  │ - 嵌入      │                 │
│  │ - Embeddings│  │ - 评测      │  │ - 轻量生成  │                 │
│  └─────────────┘  └─────────────┘  └─────────────┘                 │
└─────────────────────────────────────────────────────────────────────┘
```

### 架构特点

| 特性 | 说明 |
|------|------|
| **前端** | Vue3 + Vite，教师端与学生端分离 |
| **后端** | FastAPI，异步支持，高性能 |
| **数据存储** | PostgreSQL + Redis + 向量数据库 |
| **AI服务** | 混合架构：本地向量搜索 + 云端AI生成 |
| **成本优化** | 90%内容匹配本地完成，仅10%调用云端AI |

---

## 二、知识图谱诊断模块

**模块定位**: 系统的"大脑"，构建每个学生的个性化知识画像

### 2.1 模块架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                      知识图谱诊断模块                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  输入层                      处理层                    输出层        │
│  ┌─────────┐              ┌─────────────┐             ┌─────────┐  │
│  │初始测评 │    ──────►   │  AI分析引擎 │    ──────►  │知识图谱 │  │
│  │- 词汇量 │              │             │             │         │  │
│  │- 语法   │              │ - 难度评估  │             │- 节点   │  │
│  │- 听说读写│              │ - 薄弱点挖掘│             │- 关系   │  │
│  └─────────┘              │ - 趋势预测  │             │- 权重   │  │
│  ┌─────────┐              └─────────────┘             └─────────┘  │
│  │持续练习 │                    │                                │
│  │- 作业   │                    ▼                                │
│  │- 测试   │              ┌─────────────┐                        │
│  │- 对话   │              │  规则引擎   │                        │
│  └─────────┘              │ - CEFR映射  │                        │
│                            │ - 考点关联  │                        │
│                            │ - 难度计算  │                        │
│                            └─────────────┘                        │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.2 核心功能

1. **多维度能力评估**: 词汇、语法、听力、口语、阅读、写作六维诊断
2. **CEFR等级映射**: 自动映射到A1-C2国际标准等级
3. **考点关联分析**: 将能力点与具体考试题型关联
4. **动态更新**: 每次练习后实时更新知识图谱

### 2.3 技术实现

```python
class KnowledgeGraphService:
    def diagnose_initial(self, student_id: str) -> Graph:
        """初始诊断 - 使用AI深度分析"""
        # 1. 获取初始测评数据
        assessment = self.get_latest_assessment(student_id)

        # 2. 调用AI进行能力分析（仅初始时调用，后续用规则）
        analysis = await self.ai_client.analyze(assessment)

        # 3. 构建知识图谱节点
        nodes = self.build_nodes(analysis)

        # 4. 建立节点间关系
        edges = self.build_edges(nodes)

        # 5. 映射CEFR等级和考点
        self.map_to_standards(nodes, edges)

        return Graph(nodes=nodes, edges=edges)

    def update_from_practice(self, student_id: str, practice: Practice):
        """持续练习更新 - 使用规则引擎（零成本）"""
        graph = self.get_graph(student_id)
        updates = self.rule_engine.analyze(practice)
        graph.apply(updates)
        self.save_graph(graph)
```

### 2.4 成本优化策略

- **初始诊断**: 使用AI深度分析（一次性成本）
- **日常更新**: 使用规则引擎（几乎零成本）
- **定期复盘**: 每周/每月才进行一次AI全面复盘
- **成本降低**: 90%以上

---

## 三、智能分级推送模块

**模块定位**: 系统的"心脏"，实现i+1理论的核心引擎

### 3.1 模块架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                      智能分级推送模块 (i+1 Recommendation)            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                     推荐引擎                                 │   │
│  │  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐  │   │
│  │  │用户画像 │    │内容画像 │    │i+1匹配 │    │多样性   │  │   │
│  │  │- 当前  │    │- 难度   │    │算法    │    │控制     │  │   │
│  │  │  等级  │    │- 话题   │    │        │    │         │  │   │
│  │  │- 兴趣  │    │- 长度   │    │        │    │         │  │   │
│  │  │- 目标  │    │- 考点   │    │        │    │         │  │   │
│  │  └────┬───┘    └────┬───┘    └────┬───┘    └────┬───┘  │   │
│  └───────┼────────────┼────────────┼────────────┼────────┘   │
│          │            │            │            │              │
│          ▼            ▼            ▼            ▼              │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              向量召回 + AI精排                          │    │
│  │  Step 1: 向量相似度召回（本地，0.01秒，无成本）          │    │
│  │  Step 2: 规则过滤（难度范围、已读过滤、考点匹配）        │    │
│  │  Step 3: AI精排Top 10（云端，1秒，产生内容推荐理由）    │    │
│  └─────────────────────────────────────────────────────────┘    │
│                              │                                    │
│                              ▼                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                      输出                                │    │
│  │  - 今日推荐阅读（3篇，难度循序渐进）                     │    │
│  │  - 针对性练习（2组，聚焦薄弱考点）                       │    │
│  │  - 口语话题（1个，结合当前水平和兴趣）                   │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 核心算法

```python
class ContentRecommendationService:
    def recommend_daily(self, student_id: str) -> DailyContent:
        # 获取学生画像
        profile = self.get_student_profile(student_id)

        # Step 1: 向量召回（快速、低成本）
        candidate_ids = self.vector_db.search(
            query_vector=profile.to_vector(),
            top_k=100,  # 召回100个候选
            filters={
                "min_difficulty": profile.level - 0.2,  # i+1范围
                "max_difficulty": profile.level + 0.3,
                "exclude_read": profile.read_history
            }
        )

        # Step 2: 规则过滤
        candidates = self.content_db.get_by_ids(candidate_ids)
        filtered = self.rule_engine.filter(candidates, profile)

        # Step 3: AI精排（仅对Top 20，大幅降低API调用）
        top_20 = filtered[:20]
        ranked = await self.ai_client.rank_contents(
            contents=top_20,
            profile=profile,
            criteria=["difficulty_fit", "interest_match", "exam_coverage"]
        )

        # Step 4: 多样性控制
        final = self.diversify(ranked[:10])

        return self.format_daily_content(final)
```

### 3.3 三段式召回策略

| 阶段 | 技术手段 | 成本 | 响应时间 |
|------|----------|------|----------|
| 向量召回 | 本地向量数据库 | 几乎为零 | <0.01秒 |
| 规则过滤 | 硬规则裁剪 | 零 | <0.1秒 |
| AI精排 | 云端API | 低 | ~1秒 |

**总成本降低**: 95%

---

## 四、AI口语陪练模块

**模块定位**: 系统的"嘴巴"，实现零压力输出的关键

### 4.1 模块架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                      AI口语陪练模块 (Speaking Practice)              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                    对话管理器                               │   │
│  │  ┌─────────────────────────────────────────────────────┐   │   │
│  │  │              场景库 (Scenario Library)               │   │   │
│  │  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐│   │   │
│  │  │  │日常问候 │  │餐厅点餐 │  │问路指路 │  │购物砍价 ││   │   │
│  │  │  │A1-A2   │  │A2-B1   │  │B1-B2   │  │B2+     ││   │   │
│  │  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘│   │   │
│  │  │  ┌─────────┐  ┌─────────┐  ┌─────────┐            │   │   │
│  │  │  │自我介绍 │  │描述经历 │  │观点表达 │  ...更多   │   │   │
│  │  │  └─────────┘  └─────────┘  └─────────┘            │   │   │
│  │  └─────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                              │                                     │
│                              ▼                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                   AI对话引擎                                │   │
│  │  ┌─────────────────────────────────────────────────────┐   │   │
│  │  │              多轮对话管理                            │   │   │
│  │  │  - 上下文记忆（最近5-10轮）                          │   │   │
│  │  │  - 对话目标追踪（是否完成交际任务）                  │   │   │
│  │  │  - 动态难度调整（根据学生表现）                      │   │   │
│  │  └─────────────────────────────────────────────────────┘   │   │
│  │  ┌─────────────────────────────────────────────────────┐   │   │
│  │  │              智能反馈生成                            │   │   │
│  │  │  - 实时纠错（语法、发音）                            │   │   │
│  │  │  - 更好表达建议（词汇升级、句式优化）                │   │   │
│  │  │  - 鼓励机制（正向强化）                              │   │   │
│  │  └─────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                              │                                     │
│                              ▼                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                   语音服务层                                │   │
│  │  ┌─────────────┐              ┌─────────────┐              │   │
│  │  │  STT（语音  │  ────────►   │  TTS（语音  │              │   │
│  │  │   识别）    │              │   合成）    │              │   │
│  │  │  - 中文/英文 │              │  - 多种声音 │              │   │
│  │  │  - 实时流式 │              │  - 情感表达 │              │   │
│  │  └─────────────┘              └─────────────┘              │   │
│  └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

### 4.2 技术实现

```python
class SpeakingPracticeService:
    async def handle_conversation(self, student_id: str, audio_data: bytes):
        # 获取学生当前水平
        profile = await self.get_student_profile(student_id)
        session = await self.get_active_session(student_id)

        # 1. 语音转文字
        user_text = await self.stt_client.transcribe(audio_data)

        # 2. 发音评测（本地轻量模型，低成本）
        pronunciation_score = self.pronunciation_checker.evaluate(
            audio_data, user_text
        )

        # 3. 构建对话上下文
        messages = self.build_messages(
            session_history=session.history,
            user_input=user_text,
            student_level=profile.level,
            scenario=session.scenario,
            pronunciation_feedback=pronunciation_score
        )

        # 4. AI生成回复
        ai_response = await self.llm_client.chat(
            messages=messages,
            system_prompt=self.get_system_prompt(profile.level, session.scenario)
        )

        # 5. 语音合成
        audio_response = await self.tts_client.synthesize(ai_response.text)

        return ConversationResponse(
            audio=audio_response,
            text=ai_response.text,
            feedback=ai_response.feedback,
            pronunciation_score=pronunciation_score
        )

    def get_system_prompt(self, level: str, scenario: str) -> str:
        """根据学生水平和场景动态生成System Prompt"""
        return f"""你是一位友好的英语对话练习伙伴，正在与{level}水平的学生练习"{scenario}"场景。

对话要求：
1. 使用{level}水平的词汇和句型
2. 每轮回复控制在2-3句话
3. 如果学生有严重语法错误，在回复中用自然的对话方式纠正
4. 保持鼓励和支持的态度
5. 引导对话朝向完成交际任务的目标

回复格式：
- 情感表达/简短回复
- [可选] 轻柔的纠正建议
- 引导性问题或回应
"""
```

### 4.3 成本优化技巧

1. **发音评测本地化**: 使用轻量本地模型（如Kaldi）
2. **System Prompt缓存**: 相同水平和场景的Prompt可复用
3. **流式响应**: 边说边合成，提升体验并可提前终止
4. **会话时长限制**: 单次练习5-10分钟

---

## 五、AI辅助备课模块

**模块定位**: 教师的"超级助教"，从重复性劳动中解放

### 5.1 模块架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                    AI辅助备课模块 (AI Lesson Planner)                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                      输入向导                               │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐        │   │
│  │  │主题输入 │  │难度选择 │  │课时长度 │  │考点要求 │        │   │
│  │  │自由文本 │  │A1-C2   │  │30-90min │  │多选标签 │        │   │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘        │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                              │                                     │
│                              ▼                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                    AI备课引擎                               │   │
│  │  ┌─────────────────────────────────────────────────────┐   │   │
│  │  │              内容生成模块                            │   │   │
│  │  │  - 核心词汇表（带释义、例句、搭配）                  │   │   │
│  │  │  - 语法点讲解（规则、例句、易错点）                  │   │   │
│  │  │  - 阅读材料（多难度版本自动生成）                   │   │   │
│  │  │  - 练习题（根据考点自动生成）                       │   │   │
│  │  └─────────────────────────────────────────────────────┘   │   │
│  │  ┌─────────────────────────────────────────────────────┐   │   │
│  │  │              结构化模块                              │   │   │
│  │  │  - 教学流程设计（热身→呈现→练习→产出）              │   │   │
│  │  │  - 时间分配建议                                      │   │   │
│  │  │  - 活动设计（互动游戏、角色扮演等）                  │   │   │
│  │  └─────────────────────────────────────────────────────┘   │   │
│  │  ┌─────────────────────────────────────────────────────┐   │   │
│  │  │              课件生成模块                            │   │   │
│  │  │  - PPT大纲自动生成                                  │   │   │
│  │  │  - 板书设计建议                                      │   │   │
│  │  │  - 课后作业设计                                      │   │   │
│  │  └─────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                              │                                     │
│                              ▼                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                      输出                                   │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐        │   │
│  │  │完整教案 │  │PPT课件  │  │练习题库 │  │分层材料 │        │   │
│  │  │(可编辑) │  │(可导出) │  │(可打印) │  │(A1/B1/C1)│        │   │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘        │   │
│  └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

### 5.2 技术实现

```python
class LessonPlanService:
    async def generate_lesson_plan(self, request: LessonPlanRequest) -> LessonPlan:
        """生成完整教案"""

        # Step 1: 检索相关教学资源
        resources = await self.content_db.search(
            topic=request.topic,
            level=request.level,
            exam_points=request.exam_points
        )

        # Step 2: AI生成教案主体（结构化输出）
        lesson_plan = await self.llm_client.generate(
            prompt=self.build_lesson_prompt(request, resources),
            response_format="json",
            schema=LessonPlanSchema
        )

        # Step 3: 生成分层阅读材料（同一主题，3个难度）
        reading_materials = await self.generate_difficulty_levels(
            base_content=lesson_plan.reading,
            levels=["A1", "B1", "C1"]
        )

        # Step 4: 生成练习题（根据考点自动生成）
        exercises = await self.generate_exercises(
            content=lesson_plan,
            exam_points=request.exam_points
        )

        # Step 5: 生成PPT大纲
        ppt_outline = await self.generate_ppt_outline(lesson_plan)

        return LessonPlan(
            metadata=request,
            plan=lesson_plan,
            reading_materials=reading_materials,
            exercises=exercises,
            ppt_outline=ppt_outline
        )

    async def generate_difficulty_levels(self, base_content: str, levels: List[str]) -> Dict[str, str]:
        """生成不同难度版本的内容"""
        tasks = [
            self.llm_client.simplify(base_content, target_level=level)
            for level in levels
        ]
        simplified = await asyncio.gather(*tasks)

        return {level: content for level, content in zip(levels, simplified)}
```

### 5.3 效率提升技巧

1. **模板库**: 常见课程类型预置模板
2. **资源复用**: 优质教案存入数据库
3. **批量生成**: 一次调用生成完整教案+练习+PPT
4. **教师反馈学习**: 记录修改习惯，优化生成质量

---

## 附录：技术栈总览

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| 前端 | Vue3 + Vite | 教师端、学生端 |
| 后端 | FastAPI | 高性能异步API框架 |
| 数据库 | PostgreSQL | 主数据存储 |
| 缓存 | Redis | 会话、热点数据 |
| 向量库 | Qdrant/Weaviate | 向量相似度搜索 |
| AI服务 | OpenAI/Anthropic | 大语言模型 |
| 语音 | Azure/阿里云 | STT/TTS服务 |
| 部署 | Docker + K8s | 容器化部署 |

---

*本文档由 AI 辅助生成，版本: v1.0*
