# æ•™æ¡ˆå¯¼å‡ºåŠŸèƒ½ä»£ç å®¡æŸ¥æŠ¥å‘Š

**å®¡æŸ¥æ—¥æœŸ**: 2026-02-07
**å®¡æŸ¥èŒƒå›´**: e4af994 åˆ° b881b79
**å®¡æŸ¥äºº**: Claude Code Senior Reviewer
**é¡¹ç›®**: AIè‹±è¯­æ•™å­¦ç³»ç»Ÿ - æ•™æ¡ˆå¯¼å‡ºåŠŸèƒ½å¢å¼º

---

## æ‰§è¡Œæ‘˜è¦

### æ€»ä½“è¯„ä¼°

**ä»£ç è´¨é‡ç­‰çº§**: â­â­â­â­â˜† (4/5)

æ•™æ¡ˆå¯¼å‡ºåŠŸèƒ½çš„å®Œæ•´å®ç°å±•ç°äº†å¯¹è®¡åˆ’çš„ä¸¥æ ¼éµå¾ªå’Œè‰¯å¥½çš„å·¥ç¨‹å®è·µã€‚ä»£ç æ¶æ„æ¸…æ™°ï¼Œæ¨¡å—èŒè´£æ˜ç¡®ï¼Œæµ‹è¯•è¦†ç›–ç‡è¾ƒé«˜ã€‚å­˜åœ¨ä¸€äº›éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œä½†æ•´ä½“ä¸Šå·²è¾¾åˆ°ç”Ÿäº§å°±ç»ªçŠ¶æ€ã€‚

### å…³é”®å‘ç°

**ä¼˜ç‚¹**:
- âœ… å®Œæ•´å®ç°äº†è®¡åˆ’çš„16ä¸ªä»»åŠ¡
- âœ… 4ç§å¯¼å‡ºæ ¼å¼å…¨éƒ¨æ”¯æŒï¼ˆWordã€PDFã€PPTXã€Markdownï¼‰
- âœ… WebSocketå®æ—¶è¿›åº¦æ¨é€å®ç°è‰¯å¥½
- âœ… æ¨¡æ¿ç®¡ç†ç³»ç»ŸåŠŸèƒ½å®Œå–„
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•å……åˆ†

**éœ€æ”¹è¿›**:
- âš ï¸ ç¼ºå°‘E2Eæµ‹è¯•æ–‡ä»¶ï¼ˆè®¡åˆ’ä¸­çš„Task 15ï¼‰
- âš ï¸ ç¼ºå°‘ç”¨æˆ·æ–‡æ¡£ï¼ˆè®¡åˆ’ä¸­çš„Task 16ï¼‰
- âš ï¸ PDFç”Ÿæˆå™¨ä½¿ç”¨äº†è¿‡åº¦å¤æ‚çš„å®ç°
- âš ï¸ å‰ç«¯ç±»å‹å®šä¹‰ä¸­å­˜åœ¨æµè§ˆå™¨å…¨å±€å˜é‡çš„é‡å¤å£°æ˜

**ç”Ÿäº§å°±ç»ªåº¦**: ğŸŸ¢ åŸºæœ¬å°±ç»ªï¼ˆå»ºè®®å®Œæˆæ–‡æ¡£åéƒ¨ç½²ï¼‰

---

## 1. è®¡åˆ’å¯¹æ¯”åˆ†æ

### 1.1 å®ç°å®Œæˆåº¦

| ä»»åŠ¡ | è®¡åˆ’å†…å®¹ | å®ç°çŠ¶æ€ | è¯„ä¼° |
|-----|---------|---------|------|
| **Phase 1: æ•°æ®åº“å’ŒåŸºç¡€è®¾æ–½** |||
| Task 1 | åˆ›å»ºæ•°æ®åº“æ¨¡å‹ | âœ… å·²å®Œæˆ | ä¸è®¡åˆ’ä¸€è‡´ |
| Task 2 | æ–‡ä»¶å­˜å‚¨æœåŠ¡ | âœ… å·²å®Œæˆ | è¶…å‡ºè®¡åˆ’ï¼ˆå¢åŠ äº†æ›´å¤šåŠŸèƒ½ï¼‰ |
| **Phase 2: æ–‡æ¡£ç”ŸæˆæœåŠ¡** |||
| Task 3 | å†…å®¹æ¸²æŸ“æœåŠ¡ | âœ… å·²å®Œæˆ | ä¸è®¡åˆ’ä¸€è‡´ |
| Task 4 | Wordæ–‡æ¡£ç”Ÿæˆ | âœ… å·²å®Œæˆ | ä¸è®¡åˆ’ä¸€è‡´ |
| Task 5 | PDFæ–‡æ¡£ç”Ÿæˆ | âœ… å·²å®Œæˆ | å®ç°å¤æ‚åº¦é«˜äºè®¡åˆ’ |
| Task 6 | PPTXæ–‡æ¡£ç”Ÿæˆ | âœ… å·²å®Œæˆ | ä¸è®¡åˆ’ä¸€è‡´ |
| **Phase 3: æ¨¡æ¿ç®¡ç†ç³»ç»Ÿ** |||
| Task 7 | æ¨¡æ¿æœåŠ¡ | âœ… å·²å®Œæˆ | ä¸è®¡åˆ’ä¸€è‡´ |
| Task 8 | æ¨¡æ¿é¢„è§ˆ | âœ… å·²å®Œæˆ | ä¸è®¡åˆ’ä¸€è‡´ |
| **Phase 4: å¼‚æ­¥ä»»åŠ¡å¤„ç†** |||
| Task 9 | ä»»åŠ¡å¤„ç†å™¨ | âœ… å·²å®Œæˆ | ä¸è®¡åˆ’ä¸€è‡´ |
| **Phase 5: WebSocketå®æ—¶æ¨é€** |||
| Task 10 | WebSocketæœåŠ¡ | âœ… å·²å®Œæˆ | ä¸è®¡åˆ’ä¸€è‡´ |
| **Phase 6: å‰ç«¯UIå¢å¼º** |||
| Task 11 | å¯¼å‡ºé€‰é¡¹é¢æ¿ | âš ï¸ éƒ¨åˆ†å®Œæˆ | åªå®ç°äº†APIï¼Œç¼ºå°‘UIç»„ä»¶ |
| Task 12 | å®æ—¶è¿›åº¦å¯¹è¯æ¡† | âœ… å·²å®Œæˆ | è¶…å‡ºè®¡åˆ’ï¼ˆå¢åŠ äº†æ›´å¤šåŠŸèƒ½ï¼‰ |
| **Phase 7: æ¨¡æ¿ç®¡ç†ç•Œé¢** |||
| Task 13 | æ¨¡æ¿ç®¡ç†å¯¹è¯æ¡† | âœ… å·²å®Œæˆ | ä¸è®¡åˆ’ä¸€è‡´ |
| Task 14 | æ¨¡æ¿ç¼–è¾‘å™¨ | âœ… å·²å®Œæˆ | ä¸è®¡åˆ’ä¸€è‡´ |
| **Phase 8: é›†æˆæµ‹è¯•ä¸æ–‡æ¡£** |||
| Task 15 | E2Eæµ‹è¯• | âŒ æœªå®Œæˆ | æµ‹è¯•æ–‡ä»¶ç¼ºå¤± |
| Task 16 | ç”¨æˆ·æ–‡æ¡£ | âŒ æœªå®Œæˆ | æ–‡æ¡£ç¼ºå¤± |

**å®Œæˆåº¦ç»Ÿè®¡**: 13/16 ä»»åŠ¡å®Œæˆ (81.25%)

### 1.2 åç¦»åˆ†æ

**è‰¯æ€§åç¦»**:
1. **æ–‡ä»¶å­˜å‚¨æœåŠ¡** (`file_storage_service.py`)
   - å¢åŠ äº† `file_exists()`, `get_file_size()`, `list_files()`, `cleanup_old_files()` æ–¹æ³•
   - è¿™äº›åŠŸèƒ½å¢å¼ºäº†ç”Ÿäº§ç¯å¢ƒçš„å¯ç”¨æ€§

2. **å®æ—¶è¿›åº¦å¯¹è¯æ¡†** (`ExportProgressDialog.vue`)
   - å¢åŠ äº†é‡è¿æœºåˆ¶ã€å¿ƒè·³æ£€æµ‹ã€é¢„è®¡æ—¶é—´æ˜¾ç¤º
   - ç”¨æˆ·ä½“éªŒæ˜¾è‘—ä¼˜äºåŸå§‹è®¡åˆ’

3. **å†…å®¹æ¸²æŸ“æœåŠ¡** (`content_renderer_service.py`)
   - æ”¯æŒäº†æ›´å¤šç« èŠ‚ç±»å‹å’Œæ ¼å¼åŒ–é€‰é¡¹
   - Markdownæ¸²æŸ“è´¨é‡æ›´é«˜

**é—®é¢˜åç¦»**:
1. **Task 11 å¯¼å‡ºé€‰é¡¹é¢æ¿** - å‰ç«¯UIç»„ä»¶æœªå®ç°ï¼Œåªæä¾›äº†API
2. **Task 15 E2Eæµ‹è¯•** - è®¡åˆ’ä¸­çš„ `frontend/tests/e2e/lesson-export.spec.ts` æ–‡ä»¶ä¸å­˜åœ¨
3. **Task 16 ç”¨æˆ·æ–‡æ¡£** - è®¡åˆ’ä¸­çš„ `docs/lesson-export-guide.md` æ–‡ä»¶ä¸å­˜åœ¨

---

## 2. ä»£ç è´¨é‡è¯„ä¼°

### 2.1 åç«¯ä»£ç è´¨é‡

#### âœ… ä¼˜ç§€å®è·µ

1. **æ¸…æ™°çš„èŒè´£åˆ†ç¦»**
```python
# export_task_processor.py: æ¸…æ™°çš„æµç¨‹åˆ†ç¦»
async def process_export_task(...) -> ExportTask:
    # 1. éªŒè¯
    # 2. åŠ è½½æ•°æ®
    # 3. æ¸²æŸ“å†…å®¹
    # 4. ç”Ÿæˆæ–‡æ¡£
    # 5. ä¿å­˜æ–‡ä»¶
    # 6. é€šçŸ¥å®Œæˆ
```

2. **å®Œå–„çš„é”™è¯¯å¤„ç†**
```python
# export_task_processor.py: æ•è·æ‰€æœ‰å¼‚å¸¸å¹¶æ›´æ–°ä»»åŠ¡çŠ¶æ€
try:
    # å¤„ç†é€»è¾‘
except HTTPException as http_exc:
    # HTTPå¼‚å¸¸ç‰¹æ®Šå¤„ç†
    await self._update_task_status(task_id, TaskStatus.FAILED, 0, error_message)
    raise
except Exception as e:
    logger.error(f"å¯¼å‡ºä»»åŠ¡å¤„ç†å¤±è´¥: {task_id}, é”™è¯¯: {e}", exc_info=e)
    await self._update_task_status(task_id, TaskStatus.FAILED, 0, error_message)
    raise
```

3. **ç±»å‹æ³¨è§£å®Œæ•´**
```python
# file_storage_service.py: æ‰€æœ‰å‚æ•°å’Œè¿”å›å€¼éƒ½æœ‰ç±»å‹æ³¨è§£
async def save_file(
    self,
    content: bytes,
    filename: str,
    format: ExportFormat
) -> tuple[str, int]:
```

#### âš ï¸ éœ€æ”¹è¿›

1. **PDFç”Ÿæˆå™¨è¿‡åº¦å¤æ‚** (`pdf_generator.py`)
   - é—®é¢˜: 520è¡Œä»£ç ï¼ŒåŠŸèƒ½ä¸ç°æœ‰çš„ `pdf_renderer_service.py` é‡å¤
   - å»ºè®®: è€ƒè™‘å¤ç”¨ç°æœ‰çš„PDFæ¸²æŸ“æœåŠ¡ï¼Œç®€åŒ–å®ç°

2. **ç¡¬ç¼–ç é…ç½®**
```python
# export_task_processor.py: è¿›åº¦é˜¶æ®µç¡¬ç¼–ç 
PROGRESS_STAGES = {
    "loading": 5,
    "rendering": 20,
    "generating": 80,
    "saving": 90,
    "completed": 100,
}
```
   - å»ºè®®: ç§»åˆ°é…ç½®æ–‡ä»¶

3. **ç¼ºå°‘è¾“å…¥éªŒè¯**
```python
# template_service.py: ç¼ºå°‘å¯¹template_dataçš„éªŒè¯
async def create_template(self, template_data: Dict[str, Any], ...):
    # æ²¡æœ‰éªŒè¯template_dataçš„å¿…è¦å­—æ®µ
    template = ExportTemplate(...)
```

### 2.2 å‰ç«¯ä»£ç è´¨é‡

#### âœ… ä¼˜ç§€å®è·µ

1. **Vue 3 ç»„åˆå¼API**
```typescript
// ExportProgressDialog.vue: æ­£ç¡®ä½¿ç”¨ç»„åˆå¼API
const { progress, currentMessage, isCompleted, errorMessage } =
  useExportWebSocket(props.taskId)
```

2. **TypeScriptç±»å‹å®šä¹‰å®Œæ•´**
```typescript
// template.ts: å®Œæ•´çš„æ¥å£å®šä¹‰
export interface ExportTemplate {
  id: string
  name: string
  description: string
  format: TemplateFormat
  // ...
}
```

3. **WebSocketé‡è¿æœºåˆ¶**
```typescript
// exportWebSocket.ts: å®Œå–„çš„é‡è¿é€»è¾‘
if (event.code !== 1000 && this.reconnectAttempts < this.maxReconnectAttempts) {
  this.scheduleReconnect()
}
```

#### âš ï¸ éœ€æ”¹è¿›

1. **æµè§ˆå™¨å…¨å±€å˜é‡é‡å¤å£°æ˜**
```typescript
// exportWebSocket.ts: è¿™äº›æ˜¯æµè§ˆå™¨å†…ç½®çš„å…¨å±€å˜é‡
declare const window: Window
declare const setInterval: (handler: TimerHandler, timeout?: number) => number
declare const clearInterval: (id: number) => void
```
   - é—®é¢˜: è¿™äº›å£°æ˜åº”è¯¥æ”¾åœ¨ `env.d.ts` æˆ– `global.d.ts` ä¸­
   - å»ºè®®: ç§»é™¤é‡å¤å£°æ˜ï¼Œä½¿ç”¨ç»Ÿä¸€çš„ç±»å‹å®šä¹‰æ–‡ä»¶

2. **é”™è¯¯æ¢å¤æœºåˆ¶ä¸å®Œå–„**
```typescript
// exportWebSocket.ts: é‡è¿åæ²¡æœ‰æ¢å¤çŠ¶æ€
private reconnect() {
  this.connect(this.taskId, this.url)
    .then(() => {
      // é‡è¿æˆåŠŸååº”è¯¥è¯·æ±‚å½“å‰çŠ¶æ€
    })
}
```

---

## 3. æ¶æ„ä¸è®¾è®¡è¯„ä¼°

### 3.1 SOLIDåŸåˆ™éµå¾ª

| åŸåˆ™ | è¯„ä¼° | ç¤ºä¾‹ |
|-----|------|------|
| **å•ä¸€èŒè´£** | âœ… è‰¯å¥½ | `ContentRendererService` åªè´Ÿè´£æ¸²æŸ“<br>`FileStorageService` åªè´Ÿè´£å­˜å‚¨ |
| **å¼€é—­åŸåˆ™** | âœ… è‰¯å¥½ | æ–‡æ¡£ç”Ÿæˆå™¨ä½¿ç”¨æ¥å£è®¾è®¡<br>å¯ä»¥è½»æ¾æ·»åŠ æ–°æ ¼å¼ |
| **é‡Œæ°æ›¿æ¢** | âœ… è‰¯å¥½ | æ‰€æœ‰ç”Ÿæˆå™¨å®ç°ç›¸åŒçš„æ¥å£ |
| **æ¥å£éš”ç¦»** | âš ï¸ ä¸€èˆ¬ | `ExportTemplateService` æ–¹æ³•è¿‡å¤š<br>å»ºè®®æ‹†åˆ†ä¸ºå¤šä¸ªæ¥å£ |
| **ä¾èµ–å€’ç½®** | âœ… è‰¯å¥½ | `ExportTaskProcessor` ä¾èµ–æŠ½è±¡çš„ `ProgressNotifier` |

### 3.2 è®¾è®¡æ¨¡å¼

1. **ç­–ç•¥æ¨¡å¼** âœ…
```python
# export_task_processor.py: æ ¹æ®æ ¼å¼é€‰æ‹©ç”Ÿæˆå™¨
if format == ExportFormat.WORD:
    return self.word_generator.generate(content, template_vars)
elif format == ExportFormat.PDF:
    return await self.pdf_generator.generate_from_lesson_plan(lesson)
```

2. **å•ä¾‹æ¨¡å¼** âœ…
```python
# progress_notifier.py: å…¨å±€å•ä¾‹
progress_notifier = ProgressNotifier()

# export_manager.py: å…¨å±€å•ä¾‹
export_manager = ExportConnectionManager()
```

3. **å·¥å‚æ¨¡å¼** âœ…
```python
# export_task_processor.py: ä¾¿æ·å‡½æ•°ä½œä¸ºå·¥å‚
def get_export_task_processor(
    db: AsyncSession,
    notifier: Optional[ProgressNotifier] = None,
) -> ExportTaskProcessor:
    return ExportTaskProcessor(db, notifier)
```

### 3.3 æ€§èƒ½è€ƒè™‘

**ä¼˜ç‚¹**:
- âœ… å¼‚æ­¥å¤„ç†ï¼šå¯¼å‡ºä»»åŠ¡åœ¨åå°æ‰§è¡Œï¼Œä¸é˜»å¡API
- âœ… WebSocketæ¨é€ï¼šé¿å…è½®è¯¢ï¼Œé™ä½æœåŠ¡å™¨è´Ÿè½½
- âœ… æ–‡ä»¶å¤§å°é™åˆ¶ï¼šé˜²æ­¢å¤§æ–‡ä»¶å¯¼è‡´å†…å­˜æº¢å‡º

**éœ€å…³æ³¨**:
- âš ï¸ å¹¶å‘æ§åˆ¶ï¼šè®¡åˆ’ä¸­æåˆ°çš„ `MAX_CONCURRENT_EXPORTS = 5` æœªå®ç°
- âš ï¸ æ–‡ä»¶æ¸…ç†ï¼š`cleanup_old_files()` æ–¹æ³•å­˜åœ¨ä½†æ²¡æœ‰å®šæ—¶ä»»åŠ¡è°ƒç”¨
- âš ï¸ å¤§æ–‡æ¡£ç”Ÿæˆï¼šç¼ºå°‘æµå¼å¤„ç†ï¼Œå¤§æ–‡æ¡£å¯èƒ½è€—å°½å†…å­˜

---

## 4. å®‰å…¨æ€§è¯„ä¼°

### 4.1 å·²å®ç°çš„å®‰å…¨æªæ–½

âœ… **æƒé™æ£€æŸ¥**
```python
# export_templates.py: åˆ›å»ºæ¨¡æ¿éœ€è¦æ•™å¸ˆæƒé™
if current_user.role not in [UserRole.TEACHER, UserRole.ADMIN, UserRole.ORGANIZATION_ADMIN]:
    raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="éœ€è¦æ•™å¸ˆæƒé™")
```

âœ… **æ–‡ä»¶å¤§å°é™åˆ¶**
```python
# file_storage_service.py: é˜²æ­¢å¤§æ–‡ä»¶æ”»å‡»
if content_size > self.max_file_size:
    raise HTTPException(status_code=413, detail=f"æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ {max_mb:.0f}MB")
```

âœ… **æ–‡ä»¶åæ¸…ç†**
```python
# export_task_processor.py: é˜²æ­¢è·¯å¾„éå†
safe_title = "".join(
    c for c in lesson.title if c.isalnum() or c in (" ", "-", "_", ".")
).strip()
```

### 4.2 å®‰å…¨éšæ‚£

âš ï¸ **WebSocketè®¤è¯ç¼ºå¤±**
```python
# export_websocket.py: tokenå‚æ•°æœªéªŒè¯
@router.websocket("/ws/lesson-export/{task_id}")
async def export_progress_websocket(
    websocket: WebSocket,
    task_id: str,
    token: str  # æ¥æ”¶äº†ä½†æ²¡æœ‰éªŒè¯
):
```
- **å»ºè®®**: åœ¨WebSocketè¿æ¥å»ºç«‹æ—¶éªŒè¯tokençš„æœ‰æ•ˆæ€§

âš ï¸ **æ¨¡æ¿æ–‡ä»¶è·¯å¾„æ³¨å…¥**
```python
# template_service.py: template_pathç›´æ¥ä½¿ç”¨
template = ExportTemplate(
    template_path=template_data["template_path"],  # æ²¡æœ‰éªŒè¯è·¯å¾„
)
```
- **å»ºè®®**: éªŒè¯è·¯å¾„åœ¨å…è®¸çš„ç›®å½•å†…

---

## 5. æµ‹è¯•è¦†ç›–ç‡

### 5.1 æµ‹è¯•æ–‡ä»¶ç»Ÿè®¡

| æ¨¡å— | æµ‹è¯•æ–‡ä»¶ | ä¼°è®¡æµ‹è¯•ç”¨ä¾‹æ•° | è¦†ç›–ç‡ä¼°è®¡ |
|-----|---------|--------------|-----------|
| å†…å®¹æ¸²æŸ“æœåŠ¡ | `test_content_renderer_service.py` | ~15 | 85% |
| æ–‡ä»¶å­˜å‚¨æœåŠ¡ | `test_file_storage_service.py` | ~12 | 80% |
| å¯¼å‡ºä»»åŠ¡å¤„ç†å™¨ | `test_export_task_processor.py` | ~18 | 75% |
| Wordç”Ÿæˆå™¨ | `test_word_generator.py` | ~10 | 70% |
| PDFç”Ÿæˆå™¨ | `document_generators/test_pdf_generator.py` | ~15 | 70% |
| PPTXç”Ÿæˆå™¨ | `test_pptx_generator.py` | ~15 | 70% |
| æ¨¡æ¿æœåŠ¡ | `test_template_service.py` | ~12 | 75% |
| æ¨¡æ¿API | `test_export_templates_api.py` | ~20 | 65% |
| WebSocket API | `test_export_websocket.py` | ~10 | 60% |
| å‰ç«¯æ¨¡æ¿API | `tests/unit/template.spec.ts` | ~8 | 50% |

**æ€»ä¼°è®¡**: ~135ä¸ªæµ‹è¯•ç”¨ä¾‹

### 5.2 æµ‹è¯•è´¨é‡è¯„ä¼°

**ä¼˜ç‚¹**:
- âœ… ä½¿ç”¨äº†pytest fixtureå’Œmock
- âœ… æµ‹è¯•è¾¹ç•Œæ¡ä»¶ï¼ˆå¦‚å¤§æ–‡ä»¶ã€æ— æ•ˆæ ¼å¼ï¼‰
- âœ… åŒ…å«é›†æˆæµ‹è¯•

**ä¸è¶³**:
- âš ï¸ ç¼ºå°‘E2Eæµ‹è¯•
- âš ï¸ å‰ç«¯ç»„ä»¶æµ‹è¯•è¦†ç›–ç‡ä½
- âš ï¸ ç¼ºå°‘æ€§èƒ½æµ‹è¯•
- âš ï¸ ç¼ºå°‘å¹¶å‘æµ‹è¯•

---

## 6. ç”Ÿäº§å°±ç»ªåº¦è¯„ä¼°

### 6.1 åŠŸèƒ½å®Œæ•´æ€§

| åŠŸèƒ½ | çŠ¶æ€ | ç”Ÿäº§å°±ç»ª |
|-----|------|---------|
| Wordæ–‡æ¡£ç”Ÿæˆ | âœ… å®Œæˆ | ğŸŸ¢ æ˜¯ |
| PDFæ–‡æ¡£ç”Ÿæˆ | âœ… å®Œæˆ | ğŸŸ¢ æ˜¯ |
| PPTXæ–‡æ¡£ç”Ÿæˆ | âœ… å®Œæˆ | ğŸŸ¢ æ˜¯ |
| Markdownå¯¼å‡º | âœ… å®Œæˆ | ğŸŸ¢ æ˜¯ |
| æ¨¡æ¿ç®¡ç† | âœ… å®Œæˆ | ğŸŸ¢ æ˜¯ |
| å®æ—¶è¿›åº¦æ¨é€ | âœ… å®Œæˆ | ğŸŸ¡ éœ€å®‰å…¨åŠ å›º |
| æ‰¹é‡å¯¼å‡º | âŒ æœªå®ç° | ğŸ”´ å¦ |
| å‰ç«¯å¯¼å‡ºUI | âš ï¸ éƒ¨åˆ† | ğŸŸ¡ éœ€å®Œå–„ |

### 6.2 éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [x] ç¯å¢ƒå˜é‡é…ç½®å®Œæ•´
- [x] æ•°æ®åº“è¿ç§»è„šæœ¬å­˜åœ¨
- [ ] ä¾èµ–ç‰ˆæœ¬å›ºå®šï¼ˆpyproject.tomlä¸­pdfç›¸å…³ä¾èµ–éœ€è¦ç²¾ç¡®ç‰ˆæœ¬ï¼‰
- [ ] æ–‡ä»¶å­˜å‚¨ç›®å½•æƒé™é…ç½®
- [ ] å®šæ—¶æ¸…ç†ä»»åŠ¡é…ç½®
- [ ] æ—¥å¿—è½®è½¬é…ç½®
- [ ] ç›‘æ§æŒ‡æ ‡é…ç½®
- [ ] é”™è¯¯å‘Šè­¦é…ç½®

### 6.3 å›æ»šè®¡åˆ’

**å»ºè®®å‡†å¤‡**:
1. æ•°æ®åº“å›æ»šè„šæœ¬
2. æ–‡ä»¶è¿ç§»è®¡åˆ’
3. åŠŸèƒ½å¼€å…³ï¼ˆfeature flagï¼‰

---

## 7. é—®é¢˜æ¸…å•ï¼ˆæŒ‰ä¸¥é‡ç¨‹åº¦ï¼‰

### 7.1 Criticalï¼ˆå¿…é¡»ä¿®å¤ï¼‰

**æ— **

### 7.2 Importantï¼ˆåº”è¯¥ä¿®å¤ï¼‰

| ID | é—®é¢˜ | ä½ç½® | å»ºè®® |
|----|------|------|------|
| IMP-1 | WebSocketè®¤è¯ç¼ºå¤± | `export_websocket.py:50` | æ·»åŠ tokenéªŒè¯ |
| IMP-2 | æ¨¡æ¿è·¯å¾„æ³¨å…¥é£é™© | `template_service.py:105` | éªŒè¯è·¯å¾„åœ¨å…è®¸ç›®å½•å†… |
| IMP-3 | E2Eæµ‹è¯•ç¼ºå¤± | `frontend/tests/e2e/` | å®ŒæˆTask 15 |
| IMP-4 | ç”¨æˆ·æ–‡æ¡£ç¼ºå¤± | `docs/` | å®ŒæˆTask 16 |
| IMP-5 | å¯¼å‡ºé€‰é¡¹UIç¼ºå¤± | `frontend/src/` | å®ŒæˆTask 11 |
| IMP-6 | å¹¶å‘æ§åˆ¶æœªå®ç° | `export_task_processor.py` | å®ç°ä¿¡å·é‡æˆ–é˜Ÿåˆ— |

### 7.3 Suggestionsï¼ˆå»ºè®®æ”¹è¿›ï¼‰

| ID | é—®é¢˜ | ä½ç½® | å»ºè®® |
|----|------|------|------|
| SUG-1 | é‡å¤çš„å…¨å±€å˜é‡å£°æ˜ | `exportWebSocket.ts:9-13` | ç§»åˆ°env.d.ts |
| SUG-2 | PDFç”Ÿæˆå™¨è¿‡äºå¤æ‚ | `pdf_generator.py` | å¤ç”¨ç°æœ‰æœåŠ¡ |
| SUG-3 | ç¡¬ç¼–ç é…ç½® | `export_task_processor.py:68` | ç§»åˆ°é…ç½®æ–‡ä»¶ |
| SUG-4 | ç¼ºå°‘è¾“å…¥éªŒè¯ | `template_service.py` | ä½¿ç”¨Pydanticæ¨¡å‹ |
| SUG-5 | é‡è¿åçŠ¶æ€æœªæ¢å¤ | `exportWebSocket.ts` | æ·»åŠ çŠ¶æ€è¯·æ±‚ |
| SUG-6 | æ–‡ä»¶æ¸…ç†æ— å®šæ—¶ä»»åŠ¡ | `file_storage_service.py` | æ·»åŠ Celeryä»»åŠ¡ |

---

## 8. æ€§èƒ½è¯„ä¼°

### 8.1 æ€§èƒ½æŒ‡æ ‡ï¼ˆåŸºäºä»£ç åˆ†æï¼‰

| æŒ‡æ ‡ | è®¡åˆ’è¦æ±‚ | ä¼°è®¡å€¼ | çŠ¶æ€ |
|-----|---------|-------|------|
| å•ä¸ªæ–‡æ¡£ç”Ÿæˆæ—¶é—´ | < 30ç§’ | ä¼°è®¡5-15ç§’ | âœ… è¾¾æ ‡ |
| WebSocketå»¶è¿Ÿ | < 500ms | ä¼°è®¡100-200ms | âœ… è¾¾æ ‡ |
| å¹¶å‘ä»»åŠ¡æ•° | 5ä¸ª | æœªé™åˆ¶ | âš ï¸ éœ€å®ç° |

### 8.2 æ€§èƒ½ç“¶é¢ˆ

1. **åŒæ­¥æ–‡ä»¶å†™å…¥**
```python
# file_storage_service.py: åŒæ­¥å†™å…¥
with open(file_path, "wb") as f:
    f.write(content)
```
- **å½±å“**: é˜»å¡äº‹ä»¶å¾ªç¯
- **å»ºè®®**: ä½¿ç”¨ `aiofiles` å¼‚æ­¥å†™å…¥

2. **å¤§æ–‡æ¡£å†…å­˜å ç”¨**
```python
# word_generator.py: æ•´ä¸ªæ–‡æ¡£åœ¨å†…å­˜ä¸­
doc_bytes = BytesIO()
doc.save(doc_bytes)
return doc_bytes.read()
```
- **å½±å“**: å¤§æ–‡æ¡£å¯èƒ½å¯¼è‡´OOM
- **å»ºè®®**: å®ç°æµå¼å¤„ç†

---

## 9. ä»£ç ç»Ÿè®¡

### 9.1 ä»£ç è¡Œæ•°

| ç±»åˆ« | æ–°å¢è¡Œæ•° | æ–‡ä»¶æ•° |
|-----|---------|-------|
| åç«¯æœåŠ¡ | ~4,500 | 12 |
| åç«¯æµ‹è¯• | ~3,500 | 9 |
| å‰ç«¯ç»„ä»¶ | ~1,800 | 4 |
| å‰ç«¯å·¥å…· | ~350 | 2 |
| å‰ç«¯æµ‹è¯• | ~280 | 1 |
| **æ€»è®¡** | **~10,430** | **28** |

### 9.2 æ–‡ä»¶å¤æ‚åº¦

| æ–‡ä»¶ | è¡Œæ•° | åœˆå¤æ‚åº¦ä¼°è®¡ | å¯ç»´æŠ¤æ€§ |
|-----|------|-------------|---------|
| `export_task_processor.py` | 612 | ä¸­ | è‰¯å¥½ |
| `pdf_generator.py` | 520 | é«˜ | ä¸€èˆ¬ |
| `pptx_generator.py` | 818 | é«˜ | ä¸€èˆ¬ |
| `word_generator.py` | 732 | ä¸­ | è‰¯å¥½ |
| `content_renderer_service.py` | 526 | ä¸­ | è‰¯å¥½ |
| `ExportProgressDialog.vue` | 739 | ä¸­ | è‰¯å¥½ |

---

## 10. æœ€ç»ˆå»ºè®®

### 10.1 ç«‹å³è¡ŒåŠ¨ï¼ˆéƒ¨ç½²å‰ï¼‰

1. **å®Œæˆæ–‡æ¡£**ï¼ˆTask 16ï¼‰
   - åˆ›å»º `docs/lesson-export-guide.md`
   - æ›´æ–°APIæ–‡æ¡£

2. **ä¿®å¤å®‰å…¨é—®é¢˜**
   - æ·»åŠ WebSocketè®¤è¯
   - éªŒè¯æ¨¡æ¿è·¯å¾„

3. **å®ç°ç¼ºå¤±åŠŸèƒ½**
   - å®Œæˆå¯¼å‡ºé€‰é¡¹UIç»„ä»¶ï¼ˆTask 11ï¼‰
   - æ·»åŠ E2Eæµ‹è¯•ï¼ˆTask 15ï¼‰

### 10.2 çŸ­æœŸæ”¹è¿›ï¼ˆ1-2å‘¨ï¼‰

1. **å¹¶å‘æ§åˆ¶**
   - å®ç°å¯¼å‡ºä»»åŠ¡é˜Ÿåˆ—
   - é™åˆ¶æœ€å¤§å¹¶å‘æ•°

2. **ç›‘æ§å’Œå‘Šè­¦**
   - æ·»åŠ PrometheusæŒ‡æ ‡
   - é…ç½®é”™è¯¯å‘Šè­¦

3. **æ€§èƒ½ä¼˜åŒ–**
   - ä½¿ç”¨å¼‚æ­¥æ–‡ä»¶å†™å…¥
   - å®ç°æ–‡æ¡£æµå¼å¤„ç†

### 10.3 é•¿æœŸæ”¹è¿›ï¼ˆ1-3æœˆï¼‰

1. **åŠŸèƒ½å¢å¼º**
   - æ”¯æŒæ‰¹é‡å¯¼å‡º
   - æ”¯æŒå¯¼å‡ºå†å²ç®¡ç†
   - æ”¯æŒå¯¼å‡ºæ¨¡æ¿å¸‚åœº

2. **æ¶æ„ä¼˜åŒ–**
   - é‡æ„PDFç”Ÿæˆå™¨
   - æ‹†åˆ†å¤§æ–‡ä»¶ä¸ºå°æœåŠ¡
   - æ·»åŠ ç¼“å­˜å±‚

3. **ç”¨æˆ·ä½“éªŒ**
   - æ·»åŠ å¯¼å‡ºé¢„è§ˆ
   - æ”¯æŒè‡ªå®šä¹‰æ ·å¼
   - æ”¯æŒå¯¼å‡ºåˆ°äº‘å­˜å‚¨

---

## 11. å®¡æŸ¥ç»“è®º

### æ€»ä½“è¯„ä»·

æ•™æ¡ˆå¯¼å‡ºåŠŸèƒ½çš„å®ç°å±•ç°äº†**æ‰å®çš„å·¥ç¨‹èƒ½åŠ›å’Œè‰¯å¥½çš„ä»£ç è´¨é‡**ã€‚å¼€å‘å›¢é˜Ÿä¸¥æ ¼éµå¾ªäº†å®æ–½è®¡åˆ’ï¼Œå®Œæˆäº†å¤§éƒ¨åˆ†åŠŸèƒ½ã€‚ä»£ç æ¶æ„æ¸…æ™°ï¼ŒèŒè´£åˆ†ç¦»è‰¯å¥½ï¼Œæµ‹è¯•è¦†ç›–ç‡è¾ƒé«˜ã€‚

### ç”Ÿäº§å°±ç»ªæ€§

**ğŸŸ¡ åŸºæœ¬å°±ç»ªï¼Œå»ºè®®å®Œæˆä»¥ä¸‹å·¥ä½œåéƒ¨ç½²**:

1. å¿…é¡»å®Œæˆï¼šç”¨æˆ·æ–‡æ¡£ã€å®‰å…¨ä¿®å¤
2. å¼ºçƒˆå»ºè®®ï¼šE2Eæµ‹è¯•ã€å¯¼å‡ºé€‰é¡¹UI
3. å»ºè®®è€ƒè™‘ï¼šå¹¶å‘æ§åˆ¶ã€æ€§èƒ½ä¼˜åŒ–

### æ„Ÿè°¢

æ„Ÿè°¢å¼€å‘å›¢é˜Ÿçš„è¾›å‹¤å·¥ä½œï¼ŒæœŸå¾…åœ¨åç»­è¿­ä»£ä¸­ç»§ç»­æ”¹è¿›ï¼

---

**å®¡æŸ¥äººç­¾å**: Claude Code Senior Reviewer
**å®¡æŸ¥æ—¥æœŸ**: 2026-02-07
**ä¸‹æ¬¡å®¡æŸ¥**: å»ºè®®åœ¨å®ŒæˆImportantçº§åˆ«é—®é¢˜åè¿›è¡Œå¤å®¡
