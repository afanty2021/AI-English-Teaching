<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags -->
</claude-mem-context>

# E2E 测试模块文档

> AI 英语教学系统 - 前端端到端测试

## 概述

本模块包含前端端到端(E2E)测试，使用 Playwright 框架验证用户交互流程和系统集成。

## 测试结构

```
e2e/
├── *.spec.ts              # 测试规格文件
├── *.fixture.ts           # 测试 fixtures
├── global-setup.ts        # 全局设置
├── auth/                  # 认证相关
│   └── storage-state.json # 预保存的认证状态
└── .auth/                 # 认证状态文件目录
    ├── teacher-storage-state.json
    └── student-storage-state.json
```

## 测试文件

| 文件 | 描述 | 状态 |
|------|------|------|
| `recommendation-loop.spec.ts` | 推荐系统闭环测试 | ✨ 新增 |
| `performance.spec.ts` | 性能测试 | ✨ 新增 |
| `student-auth.fixture.ts` | 学生认证 fixture | ✨ 新增 |
| `question-editor.spec.ts` | 题目编辑器测试 | 已存在 |
| `auth-test.spec.ts` | 认证测试 | 已存在 |

## 运行测试

### 所有 E2E 测试

```bash
cd frontend
npx playwright test
```

### 推荐系统闭环测试

```bash
# 使用学生认证
npx playwright test recommendation-loop.spec.ts --project=chromium-student

# 使用教师认证
npx playwright test recommendation-loop.spec.ts --project=chromium
```

### 性能测试

```bash
npx playwright test performance.spec.ts
```

### 生成测试报告

```bash
# HTML 报告
npx playwright test --reporter=html
open playwright-report/index.html
```

## 测试配置

### Playwright 配置 (`playwright.config.ts`)

```typescript
export default defineConfig({
  testDir: './e2e',
  globalSetup: './e2e/global-setup.ts',
  use: {
    baseURL: 'http://localhost:5174',
    trace: 'on-first-retry',
  },
  projects: [
    { name: 'chromium', use: { storageState: 'e2e/.auth/teacher-storage-state.json' } },
    { name: 'chromium-student', use: { storageState: 'e2e/.auth/student-storage-state.json' } },
  ],
})
```

### 认证状态

- **教师**: `e2e/.auth/teacher-storage-state.json`
- **学生**: `e2e/.auth/student-storage-state.json`

## 推荐系统测试

### 测试场景

1. **完整闭环测试** (`recommendation-loop.spec.ts`)
   - 从推荐进入练习
   - 完成练习后验证图谱更新
   - 薄弱点针对性练习
   - 二次推荐验证图谱变化

2. **性能测试** (`performance.spec.ts`)
   - 页面加载性能
   - API响应时间
   - 内存使用监控
   - 并发请求测试

3. **错误处理测试**
   - 网络错误处理
   - API错误降级

### 性能阈值

| 指标 | 阈值 | 说明 |
|------|------|------|
| 页面加载时间 | < 5秒 | 首屏渲染完成 |
| API响应时间 | < 2秒 | 单个API请求 |
| 按钮交互响应 | < 2秒 | 用户交互响应 |
| P95响应时间 | < 5秒 | 95%请求完成 |

## Fixtures

### 学生认证 Fixture

```typescript
import { test } from './student-auth.fixture'

test('studentPage', async ({ studentPage }) => {
  const { page, studentData } = studentPage
  // 使用学生认证页面进行测试
})
```

### 教师认证 Fixture

```typescript
import { test } from './fixtures'

test('authenticatedPage', async ({ authenticatedPage }) => {
  // 使用教师认证页面进行测试
})
```

## 常见问题

### 测试失败

1. **检查开发服务器**: 确保 `npm run dev` 在运行
2. **检查认证状态**: 运行 `npx playwright install --with-deps`
3. **清除缓存**: 删除 `node_modules/.playwright` 后重新安装

### 认证问题

```bash
# 重新生成认证状态
npx playwright install
node e2e/global-setup.ts
```

## 相关资源

- [Playwright 文档](https://playwright.dev/docs)
- [Vue Test Utils](https://test-utils.vuejs.org/)
- [Vitest](https://vitest.dev/)
