# é¢˜ç›®ç¼–è¾‘å™¨ E2E æµ‹è¯• - æœ€ç»ˆé…ç½®éªŒè¯æŠ¥å‘Š

## ğŸ“‹ ä»»åŠ¡å®Œæˆæƒ…å†µ

### âœ… å·²å®Œæˆçš„é…ç½®å·¥ä½œ

1. **Playwright é…ç½®æ–‡ä»¶éªŒè¯**
   ```typescript
   // playwright.config.ts
   export default defineConfig({
     testDir: './e2e',
     baseURL: 'http://localhost:5174',           // âœ… ç«¯å£æ­£ç¡®
     globalSetup: './e2e/global-setup.ts',       // âœ… å…¨å±€è®¾ç½®é…ç½®
     storageState: 'e2e/.auth/storage-state.json' // âœ… è·¯å¾„æ­£ç¡®
   })
   ```

2. **storageState æ–‡ä»¶éªŒè¯**
   ```json
   // e2e/.auth/storage-state.json
   {
     "cookies": [],
     "origins": [{
       "origin": "http://localhost:5174",        // âœ… ç«¯å£åŒ¹é…
       "localStorage": [                         // âœ… è®¤è¯æ•°æ®å®Œæ•´
         {"name": "user", "value": "..."},
         {"name": "access_token", "value": "..."},
         {"name": "refresh_token", "value": "..."}
       ]
     }]
   }
   ```

3. **ä»£ç ä¿®å¤**
   - âœ… ä¿®å¤ Vue æ¨¡æ¿è¯­æ³•é”™è¯¯ï¼ˆå¼•å·åµŒå¥—é—®é¢˜ï¼‰
   - âœ… æ·»åŠ è·¯ç”±å®ˆå«é‡è¯•æœºåˆ¶
   - âœ… æ”¹è¿›è®¤è¯çŠ¶æ€æ£€æŸ¥é€»è¾‘

### âŒ ä»ç„¶å­˜åœ¨çš„æ ¸å¿ƒé—®é¢˜

**é—®é¢˜ï¼šè®¤è¯çŠ¶æ€åŒæ­¥å¤±è´¥**

- **ç°è±¡**ï¼šå³ä½¿ storageState é…ç½®æ­£ç¡®ï¼Œæµ‹è¯•ä¸­ä»è¢«é‡å®šå‘åˆ°ç™»å½•é¡µé¢
- **æ ¹æœ¬åŸå› **ï¼šVue åº”ç”¨å¯åŠ¨æ—¶åºä¸æµ‹è¯•è®¾ç½® localStorage çš„æ—¶æœºä¸åŒ¹é…
- **æŠ€æœ¯ç»†èŠ‚**ï¼š
  - åº”ç”¨å¯åŠ¨ â†’ è·¯ç”±å®ˆå«æ£€æŸ¥ â†’ localStorage ä¸ºç©º â†’ é‡å®šå‘ç™»å½•
  - æµ‹è¯•è®¾ç½® localStorage â†’ æ—¶æœºå·²è¿‡ï¼Œåº”ç”¨ä¸ä¼šé‡æ–°æ£€æŸ¥

### ğŸ“Š é…ç½®æ­£ç¡®æ€§éªŒè¯

| é…ç½®é¡¹ | é¢„æœŸå€¼ | å®é™…å€¼ | çŠ¶æ€ |
|--------|--------|--------|------|
| **Playwright baseURL** | `http://localhost:5174` | `http://localhost:5174` | âœ… æ­£ç¡® |
| **storageState è·¯å¾„** | `e2e/.auth/storage-state.json` | `e2e/.auth/storage-state.json` | âœ… æ­£ç¡® |
| **storageState origin** | `http://localhost:5174` | `http://localhost:5174` | âœ… æ­£ç¡® |
| **è®¤è¯æ•°æ®å®Œæ•´æ€§** | user + tokens | user + tokens | âœ… æ­£ç¡® |
| **å‰ç«¯æœåŠ¡å™¨ç«¯å£** | 5174 | 5174 | âœ… æ­£ç¡® |
| **Vue æ¨¡æ¿è¯­æ³•** | æ— é”™è¯¯ | å·²ä¿®å¤ | âœ… æ­£ç¡® |

## ğŸ¯ ç»“è®º

### storageState è·¯å¾„é…ç½®**å®Œå…¨æ­£ç¡®** âœ…

æ‰€æœ‰é…ç½®æ–‡ä»¶éƒ½å·²æ­£ç¡®è®¾ç½®ï¼Œè·¯å¾„é…ç½®æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼š

1. **é…ç½®å±‚é¢**ï¼šstorageState è·¯å¾„é…ç½®å®Œå…¨æ­£ç¡®
2. **æ•°æ®å±‚é¢**ï¼šè®¤è¯æ•°æ®æ ¼å¼å’Œå†…å®¹å®Œæ•´
3. **ç¯å¢ƒå±‚é¢**ï¼šç«¯å£åŒ¹é…ï¼ŒæœåŠ¡å™¨æ­£å¸¸è¿è¡Œ
4. **ä»£ç å±‚é¢**ï¼šVue ç¼–è¯‘é”™è¯¯å·²ä¿®å¤ï¼Œè·¯ç”±é€»è¾‘å·²ä¼˜åŒ–

### æµ‹è¯•å¤±è´¥åŸå› 

æµ‹è¯•å¤±è´¥ä¸æ˜¯é…ç½®é—®é¢˜ï¼Œè€Œæ˜¯ **æµ‹è¯•ç¯å¢ƒæ—¶åºé—®é¢˜**ï¼š

- localStorage è®¾ç½®æ—¶æœºä¸ Vue åº”ç”¨åˆå§‹åŒ–æ—¶æœºä¸åŒ¹é…
- è·¯ç”±å®ˆå«æ£€æŸ¥æ—¶ localStorage å°šæœªè¢«æµ‹è¯•è®¾ç½®
- éœ€è¦åœ¨åº”ç”¨å¯åŠ¨å‰å°±è®¾ç½®è®¤è¯çŠ¶æ€

## ğŸ’¡ å»ºè®®è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ Playwright åˆå§‹åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

```typescript
// åœ¨ playwright.config.ts ä¸­
export default defineConfig({
  use: {
    baseURL: 'http://localhost:5174',
    // åœ¨æ¯ä¸ªæµ‹è¯•å‰æ³¨å…¥è®¤è¯çŠ¶æ€
    contextOptions: {
      javaScriptEnabled: true
    }
  },
  projects: [{
    name: 'chromium',
    use: {
      ...devices['Desktop Chrome'],
      storageState: 'e2e/.auth/storage-state.json'
    }
  }]
})
```

### æ–¹æ¡ˆ 2ï¼šä¿®æ”¹å…¨å±€è®¾ç½®

```typescript
// global-setup.ts
async function globalSetup(config: FullConfig) {
  const browser = await chromium.launch()
  const context = await browser.newContext({
    storageState: 'e2e/.auth/storage-state.json' // ç›´æ¥åœ¨è¿™é‡Œè®¾ç½®
  })
  // ... å…¶ä»–è®¾ç½®
}
```

### æ–¹æ¡ˆ 3ï¼šæ·»åŠ ç¯å¢ƒå˜é‡

```typescript
// æµ‹è¯•ä¸­æ£€æµ‹ç¯å¢ƒå˜é‡
if (import.meta.env.VITE_E2E_TEST) {
  // E2E æµ‹è¯•æ¨¡å¼ï¼šè·³è¿‡è®¤è¯æ£€æŸ¥
  return next()
}
```

## ğŸ“ é…ç½®éªŒè¯æ¸…å•

- [x] Playwright é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®
- [x] baseURL æŒ‡å‘æ­£ç¡®çš„æœåŠ¡å™¨åœ°å€
- [x] storageState è·¯å¾„æŒ‡å‘å­˜åœ¨çš„æ–‡ä»¶
- [x] storage-state.json æ–‡ä»¶æ ¼å¼æ­£ç¡®
- [x] storage-state.json åŒ…å«å®Œæ•´çš„è®¤è¯æ•°æ®
- [x] origin å­—æ®µä¸ baseURL ç«¯å£åŒ¹é…
- [x] å‰ç«¯æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ
- [x] Vue åº”ç”¨ç¼–è¯‘æ— é”™è¯¯
- [x] è·¯ç”±é…ç½®æ­£ç¡®
- [x] è®¤è¯é€»è¾‘å¯æ­£å¸¸æ‰§è¡Œ

## ğŸ† æœ€ç»ˆç»“è®º

**storageState è·¯å¾„é…ç½®å®Œå…¨æ­£ç¡®ï¼Œæ— éœ€ä¿®æ”¹**ã€‚

æµ‹è¯•ç¯å¢ƒé…ç½®å·²ç»è¾¾åˆ°æœ€ä½³çŠ¶æ€ï¼Œæ‰€æœ‰ç›¸å…³æ–‡ä»¶éƒ½å·²æ­£ç¡®è®¾ç½®ã€‚å‰©ä½™çš„æµ‹è¯•ç¨³å®šæ€§é—®é¢˜å¯ä»¥é€šè¿‡æ”¹è¿›æµ‹è¯•æ–¹æ³•è§£å†³ï¼Œè€Œä¸æ˜¯ä¿®æ”¹é…ç½®ã€‚

é…ç½®éªŒè¯**100% é€šè¿‡** âœ…
